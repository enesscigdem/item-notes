<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="clr-namespace:ItemNotes.UI.Converters"
    x:Class="ItemNotes.UI.Views.MainWindow"
    Title="Item Notes"
    Width="820"
    Height="600"
    RequestedThemeVariant="Light">

    <!-- Converter kaynakları -->
    <Window.Resources>
        <conv:NoteColorToBrushConverter x:Key="NoteColorToBrushConverter"/>
        <conv:NullToBoolConverter       x:Key="NullToBoolConverter"/>
    </Window.Resources>

    <!-- Stil tanımları (Resources DEĞİL, Styles içinde) -->
    <Window.Styles>
        <Style Selector="TextBlock.note-title">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        <Style Selector="TextBlock.note-meta">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Opacity"  Value="0.75"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>
    </Window.Styles>

    <DockPanel>

        <!-- Üst Menü -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Dosya">
                <MenuItem Header="_Yeni Not"   Command="{Binding CreateNoteCommand}"/>
                <MenuItem Header="_Seçileni Aç"
                          Command="{Binding OpenNoteCommand}"
                          IsEnabled="{Binding SelectedNote, Converter={StaticResource NullToBoolConverter}}"/>
                <MenuItem Header="_Seçileni Sil"
                          Command="{Binding DeleteNoteCommand}"
                          IsEnabled="{Binding SelectedNote, Converter={StaticResource NullToBoolConverter}}"/>
                <Separator/>
                <MenuItem Header="_Çıkış" Click="OnExit"/>
            </MenuItem>
            <MenuItem Header="_Yardım">
                <MenuItem Header="_Hakkında"/>
            </MenuItem>
        </Menu>

        <!-- Komut Çubuğu -->
        <Grid DockPanel.Dock="Top" Margin="12,8,12,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="Notlar" FontSize="24" FontWeight="SemiBold" />

            <Button Grid.Column="1"
                    Margin="8,0,0,0"
                    Content="Seçileni Aç"
                    Command="{Binding OpenNoteCommand}"
                    IsEnabled="{Binding SelectedNote, Converter={StaticResource NullToBoolConverter}}"/>

            <Button Grid.Column="2"
                    Margin="8,0,0,0"
                    Content="Yeni Not"
                    Command="{Binding CreateNoteCommand}"/>
        </Grid>

        <!-- Kart ızgarası -->
        <ScrollViewer Margin="12">
            <ListBox ItemsSource="{Binding Notes}"
                     SelectedItem="{Binding SelectedNote}"
                     BorderThickness="0">
                <!-- WrapPanel ile “board/grid” hissi -->
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel ItemWidth="260" ItemHeight="110" Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border CornerRadius="12"
                                Width="240" Height="90"
                                Margin="10"
                                Background="{Binding Color, Converter={StaticResource NoteColorToBrushConverter}}"
                                BorderThickness="2"
                                BorderBrush="#26000000"
                                Padding="12">
                            <!-- ÖNEMLİ: TransformOperations ile başlangıç ver -->
                            <Border.RenderTransform>
                                <TransformOperations>scale(1)</TransformOperations>
                            </Border.RenderTransform>

                            <StackPanel>
                                <TextBlock Classes="note-title" Text="{Binding Title}"/>
                                <TextBlock Classes="note-meta"
                                           Text="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                            </StackPanel>

                            <!-- Hover efekti (aynı tip: TransformOperations) -->
                            <Border.Styles>
                                <Style Selector="Border:pointerover">
                                    <Setter Property="Opacity" Value="0.98"/>
                                    <Setter Property="RenderTransform" Value="scale(1.02)"/>
                                </Style>
                            </Border.Styles>

                            <!-- Sağ tık menüsü -->
                            <Border.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Aç"
                                              Command="{Binding $parent[ListBox].DataContext.OpenNoteCommand}"
                                              CommandParameter="{Binding}"/>
                                    <MenuItem Header="Sil"
                                              Command="{Binding $parent[ListBox].DataContext.DeleteNoteCommand}"
                                              CommandParameter="{Binding}"/>
                                </ContextMenu>
                            </Border.ContextMenu>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </ScrollViewer>
    </DockPanel>
</Window>
