<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="clr-namespace:ItemNotes.UI.Converters"
    xmlns:views="clr-namespace:ItemNotes.UI.Views"
    xmlns:controls="clr-namespace:ItemNotes.UI.Controls"
    x:Class="ItemNotes.UI.Views.NoteWindow"
    Title="{Binding Note.Title}"
    Width="900"
    Height="640"
    RequestedThemeVariant="Light"
    SystemDecorations="None"
    WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <conv:NoteColorToBrushConverter x:Key="NoteColorToBrushConverter"/>
    </Window.Resources>

    <Border x:Name="RootBorder"
            Background="{Binding Note.Color, Converter={StaticResource NoteColorToBrushConverter}}"
            CornerRadius="16"
            Padding="0"
            BorderThickness="2"
            BorderBrush="#2A000000">

        <DockPanel>

            <!-- Title / Toolbar -->
            <Border x:Name="TitleBar"
                    DockPanel.Dock="Top"
                    Background="#19FFFFFF"
                    Padding="8,6"
                    PointerPressed="TitleBar_PointerPressed">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Sol: Basit toolbar -->
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <Button Content="Yeni Sayfa" Command="{Binding AddPageCommand}"/>
                        <Separator Width="8"/>
                        <Button Content="Kaydet" Click="OnSaveClick" ToolTip.Tip="Kaydet (Ctrl/⌘+S)"/>
                    </StackPanel>

                    <!-- Sağ: renk ve meta -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Spacing="8">
                        <Menu>
                            <MenuItem Header="Renk">
                                <MenuItem Header="Sarı" Click="ChangeColorYellow"/>
                                <MenuItem Header="Yeşil" Click="ChangeColorGreen"/>
                                <MenuItem Header="Kırmızı" Click="ChangeColorRed"/>
                            </MenuItem>
                            <MenuItem Header="Kapat" Click="OnCloseClick"/>
                        </Menu>
                        <TextBlock Text="·" Margin="4,0"/>
                        <TextBlock Text="{Binding Note.CreatedBy}"/>
                        <TextBlock Text="·"/>
                        <TextBlock Text="{Binding Note.CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- İçerik -->
            <TabControl x:Name="PagesTabControl"
                        ItemsSource="{Binding Pages}"
                        SelectedItem="{Binding SelectedPage}"
                        Margin="10,10,10,12">
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Header}" />
                    </DataTemplate>
                </TabControl.ItemTemplate>

                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <controls:CkEditorView x:Name="Editor"
                                               Html="{Binding Html}"/>
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>
        </DockPanel>
    </Border>

    <!-- Kısayollar: Avalonia => KeyBindings -->
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveCommand}"/>
        <KeyBinding Gesture="Cmd+S" Command="{Binding SaveCommand}"/>
    </Window.KeyBindings>
</Window>
